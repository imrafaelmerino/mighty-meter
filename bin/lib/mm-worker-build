#!/usr/bin/env bash
set -o errexit
set -o pipefail
set -o nounset
#set -o xtrace
echo ""
echo "Executing script:$0 $@"
echo ""

main(){

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
source functions
source ../.versions
source ../.defaults

assertNotEmpty "_JIG_VERSION variable should be defined in .versions file" ${_JIG_VERSION}
assertNotEmpty "_JMETER_VERSION variable should be defined in .versions file" ${_JMETER_VERSION}
assertNotEmpty "_NAME_WORKER_SERVER_IMAGE variable should be defined in .defaults file" ${_NAME_LEADER_NGINX_IMAGE}
assertNotEmpty "_PATH_VOLUME_JMETER_LOGS variable should be defined in .defaults file" ${_PATH_VOLUME_JMETER_LOGS}


JMETER_URL="https://archive.apache.org/dist/jmeter/binaries/apache-jmeter-${_JMETER_VERSION}.tgz"

echo ${JMETER_URL}
echo "Building jmeter image..."
docker build -t myjmeter:${_JIG_VERSION} \
--build-arg JMETER_DOWNLOAD_URL=${JMETER_URL} \
../../myjmeter

echo "Building mm-worker image..."
docker build -t ${_NAME_WORKER_SERVER_IMAGE}:${_JIG_VERSION} \
--build-arg VOLUME_LOGS=${_PATH_VOLUME_JMETER_LOGS} \
../../worker

}

main "$@"